<!DOCTYPE html><html><head>
      <title>HLD</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.css">
      
      
      <script src="https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.min.js"></script>
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:local("Material Icons"),local("MaterialIcons-Regular"),url("data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAfIAAsAAAAADDAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW7kosY21hcAAAAYAAAADTAAACjtP6ytBnbHlmAAACVAAAAxgAAAQ4zRtvlGhlYWQAAAVsAAAALwAAADYRwZsnaGhlYQAABZwAAAAcAAAAJAeKAzxobXR4AAAFuAAAABIAAAA8OGQAAGxvY2EAAAXMAAAAIAAAACAG5AfwbWF4cAAABewAAAAfAAAAIAEfAERuYW1lAAAGDAAAAVcAAAKFkAhoC3Bvc3QAAAdkAAAAYgAAAK2vz7wkeJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkPsQ4gYGVgYOpk+kMAwNDP4RmfM1gxMjBwMDEwMrMgBUEpLmmMDgwVLy4xKzzX4chhrmK4QpQmBEkBwAZygyweJzFkr0NwjAQhZ+TEP6CRUfHBEwRUWaQTICyQbpMwRCskA5RUIONxG0RnnNpKAIV4qzPku/8c353ACYAYrIjCWCuMAh2ptf0/hiL3p/gyPUWa3osqlt0L1zu9r71z8dGrJRykFoauXQd932Lj5vhG+MjxGeYI8MKETObMpslf5EyP8tg+vHun5r539PvlvXzaVhRFVQDTPEWKVQR90KhnnC5Ek67vUKN4VuFasM/ldARj43CCkCsEjpJSoVVgRyU0GVSK6wUpFFCx8lFgX0BiXpRPQB4nE2TTWjcRhTH3xttpDhxN7uxPlp3u/FK7moRPixafRijNosxSw/LUsIwNcaEHPZggo/FmEKMCKWU4kNOOftQSlhE8alnH0Ix9BqWnHooPRrTQ0+mnu2bXTu2pPdGM9LM/6c3fwECTM4gBBMYQNqxzLrZAjqYSlqu2TAHZQA0/DQJH6FtzqGDnvbt4Ggwvzw/nL8EfH8kW0fsuRqhgWXZnY7M1picaUL7Du5BHeDzMIl83dAt016wH1qmvtSMo5R6YRJHTR//FXsff/nj/tc/5K9P5d+nP22+fFK5u7v3K39SW3y+OtDKO3L85vD09PD9z5X17a2N1g4tqk01RlqX7gyoEmnsWQtVr4rtZMmukEaFBZxzefkCn11cyKMLZgshRwgTYNoLNXCBz2ja7HvZG7hDpPSNfoo5vs0knK/9hb+rNpu+8kHPgk/Ao4kK3tWtTpSEtvkA9c+wE6UaUdwieNkaHg55tBEtRiEPw1s0+FtrtTcc9two2lhMknV7PZF/cs6+uUFTmpTGbEx7sQCPSLOttHS3GRltqp7SNzVSKzl6aWnZT/CX5k6/v9N3Hh8fHBwffJVjhrC6OgH5dkIt/tPsq+d/PD5Qz7G7efzq1THFjdZVPe/N6ulQ3JnDWSE5junsFsVIiFwL/htf1S5gJ3BfOcUxfHKLnzqpFpyfZ9cX+/5WB6a+Y0pHpzkNrYNVDwMsikK+y7WuLCRg/oFHkA8VT3rDg5ZnU6ktzzINymV0m74Xd5pfIGXyFeVEQSShkzqG7TBBa2OxVRKitLXv7h3uuftXnXq7lz2tZ/WnWa9dx9dCjDhHzmuVQATlmljr9dZErUydSo2Hbi/b1vXtrOeGCk2/8s3ZlO8+ueJT8BVlw5pGw2oYccdSiHHqx0RlabHqdNR9jAETl6PreJcPBnnfpTLnOQ8C3OV8AmQGzouV1iZdeb5SSIoVc8W8/kcDtksUH5FrU6/aqBqNWcMEzxG4DAQ14qRQhi9mWU0rzepKezbjfgCwQKxVYq5ajRgpRqy45CqwkJydcEkbTkvRz8P5/2ZpDTN4nGNgZGBgAOKb6v+/xvPbfGXgZmEAgeuB2kkI+v8bFgbmKiCXg4EJJAoAPyAKhQB4nGNgZGBg1vmvwxDDwgACQJKRARXwAwAzZQHQeJxjYQCCFAYGFgbSMQAcWACdAAAAAAAAAAwALgBgAIQAmADSAQgBIgE8AVABoAHeAfwCHHicY2BkYGDgZ7BgYGMAASYg5gJCBob/YD4DAA/hAWQAeJxlkbtuwkAURMc88gApQomUJoq0TdIQzEOpUDokKCNR0BuzBiO/tF6QSJcPyHflE9Klyyekz2CuG8cr7547M3d9JQO4xjccnJ57vid2cMHqxDWc40G4Tv1JuEF+Fm6ijRfhM+oz4Ra6eBVu4wZvvMFpXLIa40PYQQefwjVc4Uu4Tv1HuEH+FW7i1mkKn6Hj3Am3sHC6wm08Ou8tpSZGe1av1PKggjSxPd8zJtSGTuinyVGa6/Uu8kxZludCmzxMEzV0B6U004k25W35fj2yNlCBSWM1paujKFWZSbfat+7G2mzc7weiu34aczzFNYGBhgfLfcV6iQP3ACkSaj349AxXSN9IT0j16JepOb01doiKbNWt1ovippz6sVYYwsXgX2rGVFIkq7Pl2PNrI6qW6eOshj0xaSq9mpNEZIWs8LZUfOouNkVXxp/d5woqebeYIf4D2J1ywQB4nG3LOw6AIBAE0B384B+PAkgEa+QwNnYmHt+EpXSal5lkSBBnoP8oCFSo0aCFRIceA0ZMmLFAYSW88rmvtMUjG3RiQ9HvpfusM6zWNmtc5H/iPewha50tOt5PS/QBx2IeSwAA") format("woff")}.admonition{box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.2);position:relative;margin:1.5625em 0;padding:0 1.2rem;border-left:.4rem solid rgba(68,138,255,.8);border-radius:.2rem;background-color:rgba(255,255,255,.05);overflow:auto}.admonition>p{margin-top:.8rem}.admonition>.admonition-title{margin:0 -1.2rem;padding:.8rem 1.2rem .8rem 3.6rem;border-bottom:1px solid rgba(68,138,255,.2);background-color:rgba(68,138,255,.1);font-weight:700}.admonition>.admonition-title:before{position:absolute;left:1.2rem;font-size:1.5rem;color:rgba(68,138,255,.8);content:"\E3C9"}.admonition>.admonition-title:before{font-family:Material Icons;font-style:normal;font-variant:normal;font-weight:400;line-height:2rem;text-transform:none;white-space:nowrap;speak:none;word-wrap:normal;direction:ltr}.admonition.abstract,.admonition.summary,.admonition.tldr{border-left-color:rgba(0,176,255,.8)}.admonition.abstract>.admonition-title,.admonition.summary>.admonition-title,.admonition.tldr>.admonition-title{background-color:rgba(0,176,255,.1);border-bottom-color:rgba(0,176,255,.2)}.admonition.abstract>.admonition-title:before,.admonition.summary>.admonition-title:before,.admonition.tldr>.admonition-title:before{color:#00b0ff;content:"\E8D2"}.admonition.hint,.admonition.tip{border-left-color:rgba(0,191,165,.8)}.admonition.hint>.admonition-title,.admonition.tip>.admonition-title{background-color:rgba(0,191,165,.1);border-bottom-color:rgba(0,191,165,.2)}.admonition.hint>.admonition-title:before,.admonition.tip>.admonition-title:before{color:#00bfa5;content:"\E80E"}.admonition.info,.admonition.todo{border-left-color:rgba(0,184,212,.8)}.admonition.info>.admonition-title,.admonition.todo>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.info>.admonition-title:before,.admonition.todo>.admonition-title:before{color:#00b8d4;content:"\E88E"}.admonition.check,.admonition.done,.admonition.success{border-left-color:rgba(0,200,83,.8)}.admonition.check>.admonition-title,.admonition.done>.admonition-title,.admonition.success>.admonition-title{background-color:rgba(0,200,83,.1);border-bottom-color:rgba(0,200,83,.2)}.admonition.check>.admonition-title:before,.admonition.done>.admonition-title:before,.admonition.success>.admonition-title:before{color:#00c853;content:"\E876"}.admonition.faq,.admonition.help,.admonition.question{border-left-color:rgba(100,221,23,.8)}.admonition.faq>.admonition-title,.admonition.help>.admonition-title,.admonition.question>.admonition-title{background-color:rgba(100,221,23,.1);border-bottom-color:rgba(100,221,23,.2)}.admonition.faq>.admonition-title:before,.admonition.help>.admonition-title:before,.admonition.question>.admonition-title:before{color:#64dd17;content:"\E887"}.admonition.attention,.admonition.caution,.admonition.warning{border-left-color:rgba(255,145,0,.8)}.admonition.attention>.admonition-title,.admonition.caution>.admonition-title,.admonition.warning>.admonition-title{background-color:rgba(255,145,0,.1);border-bottom-color:rgba(255,145,0,.2)}.admonition.attention>.admonition-title:before{color:#ff9100;content:"\E417"}.admonition.caution>.admonition-title:before,.admonition.warning>.admonition-title:before{color:#ff9100;content:"\E002"}.admonition.fail,.admonition.failure,.admonition.missing{border-left-color:rgba(255,82,82,.8)}.admonition.fail>.admonition-title,.admonition.failure>.admonition-title,.admonition.missing>.admonition-title{background-color:rgba(255,82,82,.1);border-bottom-color:rgba(255,82,82,.2)}.admonition.fail>.admonition-title:before,.admonition.failure>.admonition-title:before,.admonition.missing>.admonition-title:before{color:#ff5252;content:"\E14C"}.admonition.bug,.admonition.danger,.admonition.error{border-left-color:rgba(255,23,68,.8)}.admonition.bug>.admonition-title,.admonition.danger>.admonition-title,.admonition.error>.admonition-title{background-color:rgba(255,23,68,.1);border-bottom-color:rgba(255,23,68,.2)}.admonition.danger>.admonition-title:before{color:#ff1744;content:"\E3E7"}.admonition.error>.admonition-title:before{color:#ff1744;content:"\E14C"}.admonition.bug>.admonition-title:before{color:#ff1744;content:"\E868"}.admonition.example,.admonition.snippet{border-left-color:rgba(0,184,212,.8)}.admonition.example>.admonition-title,.admonition.snippet>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.example>.admonition-title:before,.admonition.snippet>.admonition-title:before{color:#00b8d4;content:"\E242"}.admonition.cite,.admonition.quote{border-left-color:rgba(158,158,158,.8)}.admonition.cite>.admonition-title,.admonition.quote>.admonition-title{background-color:rgba(158,158,158,.1);border-bottom-color:rgba(158,158,158,.2)}.admonition.cite>.admonition-title:before,.admonition.quote>.admonition-title:before{color:#9e9e9e;content:"\E244"}
.markdown-preview.markdown-preview {
  @import 'lxgw-wenkai-webfont/lxgwwenkai-regular.css';
  @import 'lxgw-wenkai-webfont/lxgwwenkai-bold.css';
  font-family: "LXGW WenKai", sans-serif;
}
.markdown-preview.markdown-preview.prince {
  font-size: smaller;
  baseUrl: ".";
}
@page {
  size: A4;
  margin: 1cm;
  @top-center {
    content: "By __raincoat__";
  }
  @bottom-center {
    content: "Page " counter(page) " of " counter(pages);
  }
}
.markdown-preview.markdown-preview.prince pre,
.markdown-preview.markdown-preview.prince code {
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow: auto;
  position: relative;
  page-break-inside: auto;
  break-inside: auto;
}

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="heavy-light-decoposition-重链剖分">Heavy-Light Decoposition 重链剖分 </h1>
<h2 id="什么是重链剖分">什么是重链剖分？ </h2>
<div class="admonition quote">
<p class="admonition-title">树链剖分</p>
<p>树链剖分是指，将一棵树分成若干条链，使得这些链具有某些性质，使得树上操作变为链上操作和跳链操作（链间操作）。</p>
</div>
<p>重链剖分（Heavy-Light Decomposition，简称 HLD）是一种把树分解为若干条链的技巧，目的是把树上的路径/子树类操作转化为若干条链上的区间操作，从而结合线段树/树状数组等数据结构高效处理。</p>
<h2 id="基本概念与性质">基本概念与性质 </h2>
<ul>
<li>选择每个节点的子树中规模最大的儿子作为它的“重儿子”，相应的边称为重边；其他边称为轻边。沿树向下，重边尽量连成长链，这些链称为重链。</li>
<li>任意节点到根路径上，至多会经过 O(log n) 条轻边（因为每次经过轻边，子树规模至少减半），这保证了分解后的链数较少。</li>
<li>对每条重链上的节点按 DFS 序（或时间戳）映射为数组的连续区间，这样路径查询可以拆成若干个区间查询；子树查询对应于以某节点为根的一段连续区间。</li>
</ul>
<h2 id="基本思路实现要点">基本思路（实现要点） </h2>
<ol>
<li>第一次 DFS（dfs1）：计算每个节点的子树大小 <code>size[u]</code>，并记录重儿子 <code>heavy[u]</code>（即 <code>size</code> 最大的儿子）。</li>
<li>第二次 DFS（dfs2）：按重链将节点分配到链顶 <code>top[u]</code>，同时记录节点在基数组中的序号 <code>dfn[u]</code>，并把同一重链上节点映射为连续的 <code>dfn</code> 区间。</li>
<li>将节点初值按 dfn 顺序放入线段树或树状数组，支持区间查询/区间修改。路径查询（u,v）时向上跳链：将 u、v 分别移动到它们链顶的较深端并在对应区间上查询，直到两节点在同一条链上。</li>
</ol>
<p>复杂度：在常见实现中，单次路径查询需要跳过 O(log n) 条链，每条链上使用线段树/树状数组的操作为 O(log n)，因此总体为 O(log^2 n)。在某些优化（如链内直接维护带跳表或融合结构）下能进一步减少常数。</p>
<h2 id="常见应用场景">常见应用场景 </h2>
<ul>
<li>路径查询与修改：例如求路径上节点权值之和/最大值、对路径上的节点加上某个值、将路径上所有权值置为某值等。</li>
<li>子树查询与修改：因为子树在 dfn 序上是连续区间，可用于子树加/子树求和/子树最大值等操作。</li>
<li>支持带权边或带权点的问题：把边权或点权映射到对应的 dfn 下（常把边权映射到子节点的 dfn 位置）。</li>
<li>结合 LCA（最近公共祖先）：在做路径分解时常用 LCA 来判断是否在同一链或结束跳链的条件。</li>
<li>动态维护与在线询问：与线段树/树状数组结合，能在线处理大量修改与查询；也可与分治、并查集等技术混用解决复杂问题。</li>
<li>竞赛题常见模式：树上区间/路径问题（例如树上 k 最近点、路径上第 k 大、树链上带约束的二分/分块处理等）。</li>
</ul>
<h2 id="示例说明简短">示例说明（简短） </h2>
<ul>
<li>要求在树上回答若干次 "将 <code>u</code> 到 <code>v</code> 路径上的所有点加上 x" 与 "询问 <code>u</code> 到 <code>v</code> 路径上所有点的和"，使用 HLD：把树映射为基数组，路径操作拆为若干区间操作并在区间上调用线段树的区间加/区间求和。</li>
<li>要求对子树内所有节点进行更新并查询子树和：直接将子树对应的 dfn 区间作为线段树的区间操作。</li>
</ul>
<h2 id="代码模板">代码模板 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-struct">struct</span> <span class="token class-name">HLDT</span><span class="token punctuation">{</span><span class="token comment">//Heavy-Light Decomposed Tree</span>
    <span class="token keyword keyword-struct">struct</span> <span class="token class-name">Node</span><span class="token punctuation">{</span><span class="token comment">//树中的每个节点 each node in the tree</span>
        <span class="token keyword keyword-int">int</span> id<span class="token punctuation">;</span><span class="token comment">//该节点的编号 idenity</span>
        <span class="token keyword keyword-int">int</span> faid<span class="token punctuation">;</span><span class="token comment">//该节点的父节点编号 father idenity</span>
        Node<span class="token operator">*</span> fa<span class="token punctuation">;</span><span class="token comment">//该节点的父节点 father</span>
        <span class="token comment">/*特别的，对于根节点 fa = nullptr faid = 0 */</span>
        <span class="token keyword keyword-int">int</span> dept<span class="token punctuation">;</span><span class="token comment">//该节点深度 depth</span>
        <span class="token keyword keyword-int">int</span> siz<span class="token punctuation">;</span><span class="token comment">//该节点的子树大小 size</span>
        Node<span class="token operator">*</span> hs<span class="token punctuation">;</span><span class="token comment">//该节点的重儿子 heavy_son</span>
        <span class="token keyword keyword-int">int</span> dfn<span class="token punctuation">;</span><span class="token comment">//该节点的dfs序号 DFS_number</span>
        Node<span class="token operator">*</span> top<span class="token punctuation">;</span><span class="token comment">//该节点所属的重链的 top 节点</span>
        std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Node<span class="token operator">*</span><span class="token operator">&gt;</span> s<span class="token punctuation">;</span><span class="token comment">//该节点的所有儿子 son</span>
        <span class="token function">Node</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> u<span class="token punctuation">,</span><span class="token keyword keyword-int">int</span> _id<span class="token punctuation">,</span><span class="token keyword keyword-auto">auto</span><span class="token operator">&amp;</span> m<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//新建一个编号为v的节点，指定u为他的父节点，自动添加 id 映射</span>
            id <span class="token operator">=</span> _id<span class="token punctuation">,</span>dept <span class="token operator">=</span> u<span class="token operator">-&gt;</span>dept <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>fa <span class="token operator">=</span> u<span class="token punctuation">,</span>faid <span class="token operator">=</span> u<span class="token operator">-&gt;</span>id<span class="token punctuation">,</span>siz <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>hs <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">,</span>top <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">,</span>dfn <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>m<span class="token punctuation">[</span>_id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
            u<span class="token operator">-&gt;</span>s<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//把该节点加入到父节点的儿子队列中</span>
        <span class="token punctuation">}</span>
        <span class="token function">Node</span><span class="token punctuation">(</span><span class="token keyword keyword-auto">auto</span><span class="token operator">&amp;</span> m<span class="token punctuation">)</span><span class="token punctuation">{</span>id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>dept <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>fa <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">,</span>faid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>siz <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>hs <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">,</span>top <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">,</span>dfn <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>m<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//新建一个编号为v的节点，指定u为他的父节点，自动添加 id 映射</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    Node<span class="token operator">*</span> root<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>unordered_map<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span>Node<span class="token operator">*</span><span class="token operator">&gt;</span> idc<span class="token punctuation">;</span><span class="token comment">//Id 控制器 id-controller</span>
    <span class="token keyword keyword-int">int</span> time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//用于创建 DFN 的时间戳</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">dfs_build</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword keyword-int">int</span> heavy<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> v<span class="token operator">:</span>g<span class="token punctuation">[</span>u<span class="token operator">-&gt;</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>v <span class="token operator">==</span> u<span class="token operator">-&gt;</span>faid<span class="token punctuation">)</span><span class="token keyword keyword-continue">continue</span><span class="token punctuation">;</span><span class="token comment">//不走回头路</span>
            Node <span class="token operator">*</span>vp <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">,</span>idc<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//指向子节点的指针 v-pointer</span>
            <span class="token function">dfs_build</span><span class="token punctuation">(</span>vp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//递归建树</span>
            u<span class="token operator">-&gt;</span>siz <span class="token operator">+=</span> vp<span class="token operator">-&gt;</span>siz<span class="token punctuation">;</span><span class="token comment">//统计子树大小 count the size of subtree</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>vp<span class="token operator">-&gt;</span>siz <span class="token operator">&gt;</span> heavy<span class="token punctuation">)</span>heavy <span class="token operator">=</span> vp<span class="token operator">-&gt;</span>siz<span class="token punctuation">,</span>u<span class="token operator">-&gt;</span>hs <span class="token operator">=</span> vp<span class="token punctuation">;</span><span class="token comment">//选出重儿子 selection for heavy son</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">dfs_link</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span>
        u<span class="token operator">-&gt;</span>dfn <span class="token operator">=</span> <span class="token operator">++</span>time<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>s<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword keyword-return">return</span><span class="token punctuation">;</span><span class="token comment">//叶子结点</span>
        u<span class="token operator">-&gt;</span>hs<span class="token operator">-&gt;</span>top <span class="token operator">=</span> u<span class="token operator">-&gt;</span>top<span class="token punctuation">;</span><span class="token function">dfs_link</span><span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>hs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//重儿子在重链上，top 继承本节点。重儿子优先 dfs，保证重链dfn连续。</span>
        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> v<span class="token operator">:</span>u<span class="token operator">-&gt;</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>v <span class="token operator">==</span> u<span class="token operator">-&gt;</span>hs<span class="token punctuation">)</span><span class="token keyword keyword-continue">continue</span><span class="token punctuation">;</span><span class="token comment">//重儿子已经走过</span>
            v<span class="token operator">-&gt;</span>top <span class="token operator">=</span> v<span class="token punctuation">;</span><span class="token function">dfs_link</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//轻儿子的 top 节点是它自己</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">dfs_build</span><span class="token punctuation">(</span>root<span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>idc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//建树</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>root<span class="token operator">-&gt;</span>top <span class="token operator">=</span> root<span class="token punctuation">;</span><span class="token function">dfs_link</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//链接重链</span>
    SGT sgt<span class="token punctuation">;</span>
    <span class="token function">HLDT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sgt<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>sgt<span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">SGT</span><span class="token double-colon punctuation">::</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token class-name">SGT</span><span class="token double-colon punctuation">::</span><span class="token function">Rge</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>此外需要一个线段树来支持区间操作，在此不赘述，见线段树章节。</p>
<h2 id="树上操作">树上操作 </h2>
<p>树上操作是指在树上进行的各种查询和修改操作，常见的有<strong>路径查询、路径修改、子树查询和子树修改</strong>等。通过重链剖分，我们可以将这些树上操作转化为<strong>链上的区间操作</strong>，从而利用线段树或树状数组高效地处理。</p>
<p>在树上的操作要被转换成在链上的操作，主要需要 <strong>LCA 指导跳链</strong>。</p>
<h3 id="lca-指导跳链">LCA 指导跳链 </h3>
<p>在 HLD 中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">LCA</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">A</span></span></span></span>（最近公共祖先）常用于判断两个节点是否在同一条链上，以及结束跳链的条件。具体来说：</p>
<ul>
<li>当查询路径 (u, v) 时，首先比较 u 和 v 的链顶节点的深度。</li>
<li>如果 u 和 v 的链顶节点不同，则将较深的节点（假设是 u）沿着链向上跳到其链顶节点的父节点，即 u = u-&gt;top-&gt;fa。</li>
<li>重复上述步骤，直到 u 和 v 的链顶节点相同，此时它们在同一条链上，可以直接在该链上进行区间查询。</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">为什么要跳链顶</p>
<p>如下图所示（两条重链构成一个人字形），如果现在两节点分别处于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span> 上，明显 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span> 的深度大于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span> 的深度。凭感觉我们会选择较深的节点向上跳链，最终跳到同一条重链上。</p>
<div class="mermaid">flowchart TB
    A----|"重链 1"|B
    B----|"重链 1"|C
    B----|"轻边"|D
    D----|"重链 2"|F
    C----|"重链 1"|G
    G----|"重链 1"|E
</div><div class="admonition error">
<p class="admonition-title">以节点深度为依据</p>
<p>我们应该跳到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>，很明显我们已经错过了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>c</mi><mi>a</mi><mo stretchy="false">(</mo><mi>E</mi><mo separator="true">,</mo><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Lca(E,F)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mclose">)</span></span></span></span></p>
</div>
<div class="admonition success">
<p class="admonition-title">以链顶深度为依据</p>
<p>以链顶深度为依据，我们会选择 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span> 向上跳链，最终跳到同一条重链上。</p>
</div>
</div>
<h3 id="跳链操作">跳链操作 </h3>
<p>所有路径操作都可以化为跳链操作，即在跳链过程中对链上的区间进行查询或修改。下面是一个示例代码模板，展示了如何在路径 (u, v) 上进行操作：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">operate_on_path</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> _u<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> _v<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>function<span class="token operator">&lt;</span><span class="token keyword keyword-void">void</span><span class="token punctuation">(</span>HLDT<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> factor<span class="token punctuation">,</span> HLDT <span class="token operator">&amp;</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-auto">auto</span> u <span class="token operator">=</span> t<span class="token punctuation">.</span>f_id<span class="token punctuation">[</span>_u<span class="token punctuation">]</span><span class="token punctuation">,</span> v <span class="token operator">=</span> t<span class="token punctuation">.</span>f_id<span class="token punctuation">[</span>_v<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//编号到指针</span>
    
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>top <span class="token operator">!=</span> v<span class="token operator">-&gt;</span>top<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>top<span class="token operator">-&gt;</span>dep <span class="token operator">&lt;</span> v<span class="token operator">-&gt;</span>top<span class="token operator">-&gt;</span>dep<span class="token punctuation">)</span> std<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span>sgt<span class="token punctuation">.</span>inrg <span class="token operator">=</span> HLDT<span class="token double-colon punctuation">::</span><span class="token class-name">SGT</span><span class="token double-colon punctuation">::</span><span class="token function">Rge</span><span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>top<span class="token operator">-&gt;</span>dfn<span class="token punctuation">,</span> u<span class="token operator">-&gt;</span>dfn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">factor</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        u <span class="token operator">=</span> u<span class="token operator">-&gt;</span>top<span class="token operator">-&gt;</span>fa<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>u <span class="token operator">!=</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>dep <span class="token operator">&lt;</span> v<span class="token operator">-&gt;</span>dep<span class="token punctuation">)</span> std<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span>sgt<span class="token punctuation">.</span>inrg <span class="token operator">=</span> HLDT<span class="token double-colon punctuation">::</span><span class="token class-name">SGT</span><span class="token double-colon punctuation">::</span><span class="token function">Rge</span><span class="token punctuation">(</span>v<span class="token operator">-&gt;</span>dfn <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> u<span class="token operator">-&gt;</span>dfn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">factor</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>或者写成这样。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">operate</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> _u<span class="token punctuation">,</span><span class="token keyword keyword-int">int</span> _v<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>function<span class="token operator">&lt;</span><span class="token keyword keyword-void">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> factor<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-auto">auto</span> u <span class="token operator">=</span> f_id<span class="token punctuation">[</span>_u<span class="token punctuation">]</span><span class="token punctuation">,</span>v <span class="token operator">=</span> f_id<span class="token punctuation">[</span>_v<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>u<span class="token operator">-&gt;</span>top <span class="token operator">!=</span> v<span class="token operator">-&gt;</span>top<span class="token punctuation">;</span>u <span class="token operator">=</span> u<span class="token operator">-&gt;</span>top<span class="token operator">-&gt;</span>fa<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>top<span class="token operator">-&gt;</span>dep <span class="token operator">&lt;</span> v<span class="token operator">-&gt;</span>top<span class="token operator">-&gt;</span>dep<span class="token punctuation">)</span>std<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sgt<span class="token punctuation">.</span>inrg <span class="token operator">=</span> <span class="token class-name">SGT</span><span class="token double-colon punctuation">::</span><span class="token function">Rge</span><span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>top<span class="token operator">-&gt;</span>dfn<span class="token punctuation">,</span>u<span class="token operator">-&gt;</span>dfn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">factor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    sgt<span class="token punctuation">.</span>inrg <span class="token operator">=</span> <span class="token class-name">SGT</span><span class="token double-colon punctuation">::</span><span class="token function">Rge</span><span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>dfn<span class="token punctuation">,</span>v<span class="token operator">-&gt;</span>dfn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">factor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>其中 <code>std::function&lt;void(HLDT&amp;)&gt; factor</code> 是一个函数对象，表示在链上进行的具体操作（例如区间加、区间求和等）。。<code>factor</code> 要写成lambda表达式的形式，方便在调用时传入具体的操作逻辑。</p>
<p>以路径加为例：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> _u<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> _v<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> w<span class="token punctuation">,</span> HLDT <span class="token operator">&amp;</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">operate_on_path</span><span class="token punctuation">(</span>_u<span class="token punctuation">,</span> _v<span class="token punctuation">,</span> <span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">(</span>HLDT <span class="token operator">&amp;</span>tree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tree<span class="token punctuation">.</span>sgt<span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span>sgt<span class="token punctuation">.</span>root<span class="token punctuation">,</span> <span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-auto">auto</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            node<span class="token operator">-&gt;</span><span class="token function">update_by</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="例题">例题 </h2>
<h3 id="luogu-p3384-模板树链剖分httpswwwluogucomcnproblemp3384"><a href="https://www.luogu.com.cn/problem/P3384">Luogu P3384 【模板】树链剖分</a> </h3>
<p>本题是树链剖分的模板题，主要考察对概念的理解和代码实现能力。题目要求在树上进行路径查询和修改，适合用 HLD 来解决。</p>
<h3 id="luogu-p2146-noi-2015软件包管理器httpswwwluogucomcnproblemp2146"><a href="https://www.luogu.com.cn/problem/P2146">Luogu P2146 【NOI 2015】软件包管理器</a> </h3>
<p>在树上进行大规模的操作，适合使用 HLD 解决。题目要求输出影响的软件包数量，可以想到把每个节点的状态映射到 HLD 的基数组上，通过查询<strong>全局和</strong>来统计受影响的软件包数量。</p>
<p><a href="..\..\..\Code\Luogu_P_2146_NOI_2015_%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8.cpp"><strong>参考代码</strong></a></p>
<h3 id="luogu-p4315-月下毛景树httpswwwluogucomcnproblemp4315"><a href="https://www.luogu.com.cn/problem/P4315">Luogu P4315 月下毛景树</a> </h3>
<p>本题有所不同的地方在于，我们通常操作的是某个节点的点权（点状态）。但是本题中<strong>有权的是边而不是点</strong>，我们需要将边权转化为点权来使用 HLD。</p>
<p>常见的做法是把边权映射到子节点的点权上（因为一个节点有且仅有一个父节点，有<strong>一一对应的关系</strong>，借助这种关系，让某个点的<strong>点权</strong>表示与其父节点连边的<strong>边权</strong>），这样在进行路径查询或修改时，就可以直接在对应的区间上操作。</p>
<div class="admonition attention">
<p class="admonition-title">特别注意</p>
<p>这样转换点权之后，两个节点的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">LCA</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">A</span></span></span></span> 的点权需要排除。因为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">LCA</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">A</span></span></span></span> 的点权其实是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>C</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">LCA</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">A</span></span></span></span> 与其父节点的边的边权，并不在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>→</mo><mi>v</mi></mrow><annotation encoding="application/x-tex">u \rightarrow v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> 的路径上。</p>
</div>
<p><a href="..\..\..\Code\Luogu_P_4315_%E6%9C%88%E4%B8%8B_%E6%AF%9B%E6%99%AF%E6%A0%91.cpp"><strong>参考代码</strong></a></p>

      </div>
      
      
    
    
    <script type="module">
// TODO: If ZenUML gets integrated into mermaid in the future,
//      we can remove the following lines.


var MERMAID_CONFIG = ({"startOnLoad":false});
if (typeof MERMAID_CONFIG !== 'undefined') {
  MERMAID_CONFIG.startOnLoad = false
  MERMAID_CONFIG.cloneCssStyles = false
  MERMAID_CONFIG.theme = "default"
}

mermaid.initialize(MERMAID_CONFIG || {})
if (typeof(window['Reveal']) !== 'undefined') {
  function mermaidRevealHelper(event) {
    var currentSlide = event.currentSlide
    var diagrams = currentSlide.querySelectorAll('.mermaid')
    for (var i = 0; i < diagrams.length; i++) {
      var diagram = diagrams[i]
      if (!diagram.hasAttribute('data-processed')) {
        mermaid.init(null, diagram, ()=> {
          Reveal.slide(event.indexh, event.indexv)
        })
      }
    }
  }
  Reveal.addEventListener('slidetransitionend', mermaidRevealHelper)
  Reveal.addEventListener('ready', mermaidRevealHelper)
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
} else {
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
}
</script>
    
    
    
  
    </body></html>